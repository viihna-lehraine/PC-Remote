name: CI/CD Pipeline

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    build-test:
        name: ğŸ”¨ Build & Test
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“¥ Checkout repository
              uses: actions/checkout@v4

            - name: ğŸ— Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 22
                  cache: 'pnpm'

            - name: ğŸ“¦ Install PNPM
              run: npm install -g pnpm

            - name: ğŸ“¦ Install dependencies
              run: pnpm install

            - name: ğŸ— Build frontend & backend
              run: pnpm run build

            - name: âœ… Run lint checks
              run: pnpm run lint

            - name: ğŸš€ Notify Discord on success
              if: success()
              run: |
                  curl -H "Content-Type: application/json" \
                       -X POST \
                       -d '{"content": "âœ… **PC Remote Build & Test Passed!** ğŸ‰"}' \
                       ${{ secrets.DISCORD_WEBHOOK }}

            - name: âŒ Notify Discord on failure
              if: failure()
              run: |
                  curl -H "Content-Type: application/json" \
                       -X POST \
                       -d '{"content": "ğŸš¨ **PC Remote Build & Test Failed!** âŒ"}' \
                       ${{ secrets.DISCORD_WEBHOOK }}
